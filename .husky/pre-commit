#!/bin/sh
echo "Running pre-commit hook..."

# Load Husky helpers
. "$(dirname "$0")/_/husky.sh"

# Try to load nvm if available (for machines using nvm)
export NVM_DIR="$HOME/.nvm"
if [ -s "$NVM_DIR/nvm.sh" ]; then
  . "$NVM_DIR/nvm.sh"
fi

# Add local node_modules binaries to PATH
export PATH="$PATH:$(npm bin)"

# Ensure lint-staged is available
if ! command -v npx >/dev/null 2>&1; then
  echo "npx not found. Skipping lint-staged."
  exit 0
fi

echo "Running lint-staged..."
npx lint-staged --debug
LINT_EXIT_CODE=$?

if [ $LINT_EXIT_CODE -ne 0 ]; then
  echo "Linting failed, commit aborted."
  exit 1
fi

echo "Pre-commit hook finished successfully."
exit 0
