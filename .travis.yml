language: node_js

node_js:
  - node

dist: trusty

cache: npm

# TODO
#  directories:
#    - '$HOME/.sonar/cache'

# Build only commits on master and release tags preventing double builds for PRs
# See https://docs.travis-ci.com/user/pull-requests/#double-builds-on-pull-requests
branches:
  only:
    - master
    - /v[0-9]+\.[0-9]+\.[0-9]+(-.*)?$/

addons:
  sonarcloud:
    organization: "ontotext-ad"
    token:
      secure: $SONARCLOUD_TOKEN

script:
  - npm run test:ci
  - npm run test:coveralls
  - npm run build
  - sonar-scanner

deploy:
  - provider: npm
    skip_cleanup: true
    email: graphdb-support@ontotext.com
    api_key: $NPM_TOKEN
    on:
      tags: true
